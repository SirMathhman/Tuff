from std::test use { reset, suite, it, expect_eq, summary, status };

from src::main::tuff::compiler::util::formatting use { parse_program_with_trivia };
from src::main::tuff::compiler::emit::tuff use { rename_ident_tokens, emit_tuff };

out fn run() : I32 => {
  reset();
  suite("emit tuff (preserve trivia) :: rename");

  let src = "fn main() => {\n  // keep me\n  let x = 1 + 2; /* and me */\n  x\n}\n";
  let expected = "fn main() => {\n  // keep me\n  let y = 1 + 2; /* and me */\n  y\n}\n";

  let p = parse_program_with_trivia(src, false);
  let ts2 = rename_ident_tokens(p.tokenStream, "x", "y");
  let out = emit_tuff(ts2);

  it("renames only identifiers", expect_eq("out", out, expected));

  summary();
  status()
}
